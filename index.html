<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Shift Calendar Sept 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, minmax(0, 1fr));
            gap: 1px;
            background-color: #e5e7eb;
        }
        .calendar-day {
            background-color: white;
            padding: 0.5rem;
            min-height: 100px;
            border: 1px solid #e5e7eb;
        }
        .calendar-day.weekend {
            background-color: #f3f4f6;
        }
        .calendar-day.header {
            background-color: #d1d5db;
            font-weight: bold;
            text-align: center;
            padding: 0.5rem;
        }
        .calendar-day.clickable {
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .calendar-day.clickable:hover {
            background-color: #f0f9ff;
        }
        .employee-chip {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            margin: 0.2rem;
            border-radius: 0.25rem;
            color: white;
            font-size: 0.875rem;
            cursor: pointer;
        }
        .employee-chip.grayed {
            background-color: #9ca3af !important;
        }
        .employee-chip.legend-selected {
            border: 2px solid #000;
        }
        #error-message {
            display: none;
            color: red;
            text-align: center;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body class="bg-gray-100 p-6">
    <h1 class="text-3xl font-bold text-center mb-6">Employee Shift Calendar (Sept 2025)</h1>
    <p class="text-center mb-4">Click a weekday to toggle employee 'a's schedule. Click an employee in the legend to gray out others. Click 'Show Updated Schedule' to view employee 'a's current schedule.</p>
    <div id="error-message">Failed to load schedule data. Please check the CSV file.</div>
    <button id="show-schedule" class="bg-blue-500 text-white px-4 py-2 rounded mb-4 hover:bg-blue-600">Show Updated Schedule for Employee 'a'</button>

    <!-- Legend -->
    <div class="mb-6">
        <h3 class="text-xl font-semibold mb-2">Employee Color Legend</h3>
        <div class="flex flex-wrap gap-2" id="legend">
            <span class="employee-chip bg-blue-500" data-employee="a" onclick="toggleEmployee('a')">a</span>
            <span class="employee-chip bg-red-500" data-employee="b" onclick="toggleEmployee('b')">b</span>
            <span class="employee-chip bg-green-500" data-employee="c" onclick="toggleEmployee('c')">c</span>
            <span class="employee-chip bg-yellow-500" data-employee="d" onclick="toggleEmployee('d')">d</span>
            <span class="employee-chip bg-purple-500" data-employee="e" onclick="toggleEmployee('e')">e</span>
            <span class="employee-chip bg-pink-500" data-employee="f" onclick="toggleEmployee('f')">f</span>
            <span class="employee-chip bg-indigo-500" data-employee="g" onclick="toggleEmployee('g')">g</span>
            <span class="employee-chip bg-orange-500" data-employee="h" onclick="toggleEmployee('h')">h</span>
        </div>
    </div>

    <div id="calendars"></div>

    <script>
        // Color mapping for employees
        const employeeColors = {
            a: 'bg-blue-500',
            b: 'bg-red-500',
            c: 'bg-green-500',
            d: 'bg-yellow-500',
            e: 'bg-purple-500',
            f: 'bg-pink-500',
            g: 'bg-indigo-500',
            h: 'bg-orange-500'
        };

        // Track selected employee for gray-out
        let selectedEmployee = null;
        let employeeSchedules = {};

        // Function to parse CSV data
        async function loadSchedule() {
            try {
                const response = await fetch('schedule.csv');
                if (!response.ok) throw new Error('Failed to fetch CSV');
                const text = await response.text();
                const lines = text.trim().split('\n');
                const headers = lines[0].split(',').map(h => h.trim());
                const data = lines[1].split(',').map(d => d.trim());

                // Map CSV data to employeeSchedules object
                headers.forEach((emp, index) => {
                    employeeSchedules[emp] = data[index] ? data[index].split(';').map(date => date.trim()) : [];
                });

                // Log loaded schedules for debugging
                console.log('Loaded employee schedules:', employeeSchedules);

                // Generate calendars
                generateCalendars();
            } catch (error) {
                console.error(error);
                document.getElementById('error-message').style.display = 'block';
            }
        }

        // Function to toggle employee 'a's schedule on a date
        function toggleDate(year, month, day) {
            const date = new Date(year, month - 1, day);
            const dateStr = date.toISOString().split('T')[0];
            const dayOfWeek = date.getDay();
            console.log(`Clicked date: ${dateStr}, Day of week: ${['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][dayOfWeek]}`);

            // Only allow toggling on weekdays (Mon-Fri: 1-5)
            if (dayOfWeek >= 1 && dayOfWeek <= 5) {
                const index = employeeSchedules['a'].indexOf(dateStr);
                if (index === -1) {
                    employeeSchedules['a'].push(dateStr);
                    employeeSchedules['a'].sort();
                } else {
                    employeeSchedules['a'].splice(index, 1);
                }
                generateCalendars();
            }
        }

        // Function to generate calendar for a given month
        function generateCalendar(year, month) {
            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month, 0);
            const daysInMonth = lastDay.getDate();
            const startDayOfWeek = firstDay.getDay();
            const monthName = firstDay.toLocaleString('default', { month: 'long' });

            console.log(`Generating calendar for ${monthName} ${year}, first day is ${['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][startDayOfWeek]} (index ${startDayOfWeek})`);

            let html = `<h2 class="text-2xl font-semibold mt-8 mb-4">${monthName} ${year}</h2>`;
            html += '<div class="calendar-grid">';
            const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            daysOfWeek.forEach(day => {
                html += `<div class="calendar-day header">${day}</div>`;
            });

            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startDayOfWeek; i++) {
                html += '<div class="calendar-day"></div>';
            }

            // Process each day of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month - 1, day);
                const dateStr = date.toISOString().split('T')[0];
                const dayOfWeek = date.getDay();
                const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                let employees = [];

                // Find employees scheduled on this date
                Object.keys(employeeSchedules).forEach(emp => {
                    if (employeeSchedules[emp].includes(dateStr)) {
                        employees.push(emp);
                    }
                });

                // Sort employees alphabetically for consistent display
                employees.sort();

                // Log date and column for debugging
                console.log(`Date: ${dateStr}, Day: ${['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][dayOfWeek]}, Employees: ${employees.join(', ')}`);

                // Add day cell
                html += `<div class="calendar-day ${isWeekend ? 'weekend' : 'clickable'}" `;
                if (!isWeekend) {
                    html += `onclick="toggleDate(${year}, ${month}, ${day})"`;
                }
                html += `>${day}`;
                if (!isWeekend && employees.length > 0) {
                    html += '<br>';
                    employees.forEach(emp => {
                        const colorClass = selectedEmployee && emp !== selectedEmployee ? 'grayed' : employeeColors[emp];
                        html += `<span class="employee-chip ${colorClass}" data-employee="${emp}">${emp}</span>`;
                    });
                }
                html += '</div>';
            }

            // Add empty cells to complete the grid
            const totalCells = startDayOfWeek + daysInMonth;
            const remainingCells = (7 - (totalCells % 7)) % 7;
            for (let i = 0; i < remainingCells; i++) {
                html += '<div class="calendar-day"></div>';
            }

            html += '</div>';
            return html;
        }

        // Function to generate all calendars
        function generateCalendars() {
            const calendarsContainer = document.getElementById('calendars');
            calendarsContainer.innerHTML = '';
            // Only generate September 2025 for reduced test data
            generateCalendar(2025, 9);
            calendarsContainer.innerHTML += generateCalendar(2025, 9);
        }

        // Function to toggle employee selection for gray-out
        function toggleEmployee(employee) {
            if (selectedEmployee === employee) {
                selectedEmployee = null;
            } else {
                selectedEmployee = employee;
            }

            const legendItems = document.querySelectorAll('#legend .employee-chip');
            legendItems.forEach(item => {
                if (item.getAttribute('data-employee') === selectedEmployee) {
                    item.classList.add('legend-selected');
                } else {
                    item.classList.remove('legend-selected');
                }
            });

            generateCalendars();
        }

        // Function to show updated schedule for employee 'a'
        function showUpdatedSchedule() {
            const schedule = employeeSchedules['a'].join(';');
            alert(`Updated schedule for employee 'a':\n${schedule}`);
            console.log(`Updated schedule for employee 'a':`, employeeSchedules['a']);
        }

        // Attach event listener to show schedule button
        document.getElementById('show-schedule').addEventListener('click', showUpdatedSchedule);

        // Load and render the schedule
        loadSchedule();
    </script>
</body>
</html>
